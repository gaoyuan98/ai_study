# go_agent_study

## 这套代码想解决什么问题
- 顶层 `agent.go` 是一个“能否连上数据库”的快检脚本，运行后用硬编码的达梦连接串 Ping 一下，成功就直接打印 `connect succeed`。
- `demo` 目录是一套 ReAct 智能体实验，给它一条任务，它会自己决定是读写文件、执行命令还是查数据库，把行动日志同步写到终端和 `agent_run_时间.log`。

## 工作原理（大白话版）
1. **先把环境搞定**：命令行入口会加载 `.env`、解析 `-project/-model/-question/-log-file`，并初始化日志器和 OpenAI 客户端。
2. **组装工具箱**：把读文件、写文件、跑命令、查达梦库、向用户追问这几种能力注册给 `ReActAgent`，统一用 `Tool` 结构描述。
3. **喂系统提示**：`react_agent.go` 把操作系统信息、项目文件列表和工具清单塞进 `prompt_template.go` 的 XML 模板里，让模型清楚“自己能干啥、输出要长啥样”。
4. **循环思考**：模型每轮都写 `<thought>` 和 `<action>`，代码解析出函数名与 JSON 风格参数；在调用前做基本校验（尤其是数据库连接串和 SQL），危险命令还要人工确认。
5. **记录观察**：工具执行后会把结果包进 `<observation>` 返给模型，日志器也会按轮次把思考、动作、反馈逐条落盘，直到模型输出 `<final_answer>`。

## 示例：让它查一份月度数据
```
go run ./demo -project . -question "帮我统计 2024-11 的 orders 实收金额"
```
可能的过程：
1. 程序加载 `.env`，给出本次日志文件位置；
2. 模型第一轮想要查库，如果 SQL 或连接串不完整，会提示 `action 参数校验失败` 并要求你输入缺失信息；
3. 参数补全后，`query_database` 真正连达梦，查询结果以制表符表格形式回传；
4. 模型根据结果生成 `<final_answer>`，你能在终端和日志里看到完整的思考链条。

> 提示：`run_terminal_command` 这种高风险动作会额外弹出 “是否继续 (Y/N)”。

## 文件速览
- `agent.go`：最小化的达梦连通性检测。
- `demo/agent.go`：命令行入口、参数解析、日志初始化。
- `demo/react_agent.go`：ReAct 主循环、提示渲染、工具调度、人工确认。
- `demo/prompt_template.go`：XML 风格提示词，附带示例和注意事项。
- `demo/logger.go`：把日志同时写到控制台和文件，带时间戳与轮次。
- `demo/tools.go`：读写文件、执行命令、查询数据库等工具实现，以及连接串格式化逻辑。
